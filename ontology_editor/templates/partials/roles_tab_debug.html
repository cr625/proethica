
<!-- DEBUG VERSION OF ROLES TAB -->
<!-- 
This template includes detailed debugging output to help diagnose 
parent class selection issues. It shows the parent.id and entity.parent_class
values for each option in each parent dropdown.
-->

    <!-- Roles Tab Content -->
{% if ontology.is_editable %}
<button class="btn btn-primary add-entity-btn" data-entity-type="role">
    <i class="bi bi-plus"></i> Add Role
</button>
{% endif %}

{% if entities and entities.entities.roles and entities.entities.roles|length > 0 %}
<div class="row">
    {% for entity in entities.entities.roles %}
    <div class="col-md-6 col-lg-4">
        <div class="card entity-item {% if not is_editable(entity) %}non-editable{% endif %}" 
             data-entity-id="{{ entity.id }}" 
             data-entity-type="role">
            <!-- View Mode -->
            <div class="card-view-mode">
                <div class="card-header">
                    <span>{{ entity.label }}</span>
                    {% if is_editable(entity) and ontology.is_editable %}
                    <button class="btn btn-sm btn-outline-primary edit-entity-btn">
                        <i class="bi bi-pencil"></i> Edit
                    </button>
                    {% endif %}
                </div>
                <div class="card-body">
                    <p class="card-text">{{ entity.description }}</p>
                    {% if entity.capabilities and entity.capabilities|length > 0 %}
                    <div class="mt-2">
                        <strong>Capabilities:</strong>
                        <ul class="list-group list-group-flush">
                            {% for capability in entity.capabilities %}
                            <li class="list-group-item ps-0 pt-1 pb-1 border-0">{{ capability.label }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    <div class="entity-origin">
                        Origin: {{ get_entity_origin(entity) }}
                    </div>
                    <div class="entity-uri">
                        ID: {{ entity.id }}
                    </div>
                </div>
            </div>
            
            <!-- Edit Mode -->
            {% if is_editable(entity) and ontology.is_editable %}
            <div class="card-edit-mode">
                <div class="card-header bg-primary text-white">
                    Edit Role
                </div>
                <div class="card-body">
                    <form class="entity-edit-form" data-entity-id="{{ entity.id }}" data-entity-type="role">
                        <div class="mb-3">
                            <label for="label-{{ entity.id }}">Label</label>
                            <input type="text" class="form-control" id="label-{{ entity.id }}" name="label" value="{{ entity.label }}" required>
                            <div class="validation-error"></div>
                        </div>
                        <div class="mb-3">
                            <label for="description-{{ entity.id }}">Description</label>
                            <textarea class="form-control" id="description-{{ entity.id }}" name="description" rows="3" required>{{ entity.description }}</textarea>
                            <div class="validation-error"></div>
                        </div>
                        <div class="mb-3">
                            <label for="parent-{{ entity.id }}">Parent Class</label>
                            
                <!-- Parent class debug:
                     Entity: {{ entity.label }}
                     Parent Class: {{ entity.parent_class }}
                -->
                <select class="form-control" id="parent-{{ entity.id }}" name="parent_class" required>
                                <!-- ENHANCED DEBUG INFO -->
                                <option value="" disabled>DEBUGGING INFO - ENTITY: {{ entity.label }}</option>
                                <option value="" disabled>Entity parent_class: "{{ entity.parent_class }}"</option>
                                <option value="" disabled>-----------------------------------</option>
                                
                                {% for parent in get_valid_parents('role') %}
                                {% set match = entity.parent_class == parent.id %}
                                <option value="{{ parent.id }}" {% if match %}selected{% endif %}>
                                    {{ parent.label }} {% if match %}âœ“MATCH{% endif %}
                                    {% if not match %}(NO MATCH){% endif %}
                                </option>
                                {% endfor %}
                            </select>
                            
                            <!-- String comparison debugging -->
                            <div class="text-muted small mt-1" style="background: #f8f9fa; padding: 5px; border-radius: 3px;">
                                <strong>Debug comparison:</strong><br>
                                {% for parent in get_valid_parents('role') %}
                                <pre>{{ parent.id|tojson }} == {{ entity.parent_class|tojson }} : {{ (parent.id == entity.parent_class)|tojson }}</pre>
                                {% if loop.index > 5 %}{% break %}{% endif %}
                                {% endfor %}
                            </div>
                
                            <div class="validation-error"></div>
                        </div>
                        <div class="mb-3">
                            <label for="capabilities-{{ entity.id }}">Capabilities</label>
                            <select class="form-control" id="capabilities-{{ entity.id }}" name="capabilities" multiple>
                                {% for capability in get_all_capabilities() %}
                                <option value="{{ capability.id }}" {% if has_capability(entity, capability) %}selected{% endif %}>
                                    {{ capability.label }}
                                </option>
                                {% endfor %}
                            </select>
                            <small class="form-text text-muted">Hold Ctrl/Cmd to select multiple capabilities</small>
                        </div>
                        <div class="d-flex justify-content-between">
                            <button type="submit" class="btn btn-success save-entity-btn">Save</button>
                            <button type="button" class="btn btn-secondary cancel-edit-btn">Cancel</button>
                            <button type="button" class="btn btn-danger delete-entity-btn">Delete</button>
                        </div>
                    </form>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-tab-message">
    <p>No roles defined in this ontology.</p>
</div>
{% endif %}
