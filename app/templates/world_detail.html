{% extends "base.html" %}

{% block title %}{{ world.name }} - AI Ethical Decision-Making Simulator{% endblock %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>{{ world.name }}</h1>
        <div>
            <a href="/worlds" class="btn btn-secondary">Back to Worlds</a>
            <a href="/worlds/{{ world.id }}/edit" class="btn btn-warning">Edit World</a>
            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteWorldModal">
                Delete World
            </button>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3>World Details</h3>
                </div>
                <div class="card-body">
                    <p>
                        <strong>Description:</strong>
                        <span id="description-{{ world.id }}" class="text-truncate">{{ world.description }}</span>
                        <button class="btn btn-link p-0" onclick="toggleDescription({{ world.id }})"
                            id="toggle-btn-{{ world.id }}">
                            Show More
                        </button>
                    </p>
                    <p>
                        <strong>Ontology Source:</strong> {{ world.ontology_source or 'Not specified' }}
                        {% if world.ontology_source %}
                        <a href="/ontology/{{ world.ontology_source }}" class="btn btn-sm btn-primary ms-2">
                            <i class="fas fa-edit"></i> Edit Ontology
                        </a>
                        {% if ontology_status == 'deprecated' %}
                        <span class="badge bg-warning ms-2" data-bs-toggle="tooltip"
                            title="This world uses an outdated version of the ontology">
                            <i class="fas fa-exclamation-triangle"></i> Deprecated
                        </span>
                        {% endif %}
                        {% endif %}
                    </p>
                    <p><strong>Created:</strong> {{ world.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                    <p><strong>Last Updated:</strong> {{ world.updated_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h3>Related Scenarios</h3>
                </div>
                <div class="card-body">
                    {% if world.scenarios %}
                    <ul class="list-group">
                        {% for scenario in world.scenarios %}
                        <li class="list-group-item">
                            <a href="/scenarios/{{ scenario.id }}">{{ scenario.name }}</a>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p>No scenarios have been created in this world yet.</p>
                    {% endif %}
                    <div class="mt-3">
                        <a href="/scenarios/new?world_id={{ world.id }}" class="btn btn-primary">Create Scenario</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Tabs Navigation -->
    <ul class="nav nav-tabs mb-4" id="worldTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="entities-tab" data-bs-toggle="tab" data-bs-target="#entities"
                type="button" role="tab" aria-controls="entities" aria-selected="true">Entities</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="guidelines-tab" data-bs-toggle="tab" data-bs-target="#guidelines" type="button"
                role="tab" aria-controls="guidelines" aria-selected="false">Guidelines</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="cases-tab" data-bs-toggle="tab" data-bs-target="#cases" type="button"
                role="tab" aria-controls="cases" aria-selected="false">Cases</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="rulesets-tab" data-bs-toggle="tab" data-bs-target="#rulesets" type="button"
                role="tab" aria-controls="rulesets" aria-selected="false">Rulesets</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="references-tab" data-bs-toggle="tab" data-bs-target="#references" type="button"
                role="tab" aria-controls="references" aria-selected="false">References</button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="worldTabsContent">
        <!-- Entities Tab -->
        <div class="tab-pane fade show active" id="entities" role="tabpanel" aria-labelledby="entities-tab">
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3>World Entities</h3>
                    {% if world.ontology_source %}
                    <div>
                        <a href="/ontology/{{ world.ontology_source }}" class="btn btn-primary">
                            <i class="fas fa-edit"></i> Edit Ontology
                        </a>
                    </div>
                    {% endif %}
                </div>
                <div class="card-body">
                    {% if entities and entities.entities %}
                    {% if entities.entities.roles or entities.entities.conditions or entities.entities.resources or
                    entities.entities.events or entities.entities.actions %}
                    <ul class="nav nav-tabs" id="entityTabs" role="tablist">
                        {% if entities.entities.roles %}
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="roles-tab" data-bs-toggle="tab" data-bs-target="#roles"
                                type="button" role="tab" aria-controls="roles" aria-selected="true">Roles</button>
                        </li>
                        {% endif %}
                        {% if entities.entities.conditions %}
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="conditions-tab" data-bs-toggle="tab"
                                data-bs-target="#conditions" type="button" role="tab" aria-controls="conditions"
                                aria-selected="false">Conditions</button>
                        </li>
                        {% endif %}
                        {% if entities.entities.resources %}
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="resources-tab" data-bs-toggle="tab" data-bs-target="#resources"
                                type="button" role="tab" aria-controls="resources"
                                aria-selected="false">Resources</button>
                        </li>
                        {% endif %}
                        {% if entities.entities.events %}
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="events-tab" data-bs-toggle="tab" data-bs-target="#events"
                                type="button" role="tab" aria-controls="events" aria-selected="false">Events</button>
                        </li>
                        {% endif %}
                        {% if entities.entities.actions %}
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="actions-tab" data-bs-toggle="tab" data-bs-target="#actions"
                                type="button" role="tab" aria-controls="actions" aria-selected="false">Actions</button>
                        </li>
                        {% endif %}