{% extends 'base.html' %}

{% block title %}System Status{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col">
            <h1>ProEthica System Status</h1>
            <p class="text-muted">Status as of {{ status.timestamp }}</p>
            <a href="{{ url_for('index.index') }}" class="btn btn-primary mb-3">Back to Home</a>
            
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card mb-2">
                        <div class="card-body text-center">
                            <h5 class="card-title">MCP Server</h5>
                            {% if status.system_status.mcp_server.status == 'online' %}
                                <div class="alert alert-success mb-0">ONLINE</div>
                            {% elif status.system_status.mcp_server.status == 'error' %}
                                <div class="alert alert-warning mb-0">ERROR</div>
                            {% elif status.system_status.mcp_server.status == 'offline' %}
                                <div class="alert alert-danger mb-0">OFFLINE</div>
                            {% else %}
                                <div class="alert alert-secondary mb-0">UNKNOWN</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card mb-2">
                        <div class="card-body text-center">
                            <h5 class="card-title">Database</h5>
                            {% if status.system_status.database.status == 'connected' %}
                                <div class="alert alert-success mb-0">CONNECTED</div>
                            {% elif status.system_status.database.status == 'error' %}
                                <div class="alert alert-danger mb-0">ERROR</div>
                            {% else %}
                                <div class="alert alert-secondary mb-0">UNKNOWN</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card mb-2">
                        <div class="card-body text-center">
                            <h5 class="card-title">Ontology</h5>
                            {% if status.system_status.ontology.status == 'available' %}
                                <div class="alert alert-success mb-0">AVAILABLE</div>
                            {% elif status.system_status.ontology.status == 'error' %}
                                <div class="alert alert-warning mb-0">ERROR</div>
                            {% else %}
                                <div class="alert alert-secondary mb-0">UNKNOWN</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card mb-2">
                        <div class="card-body text-center">
                            <h5 class="card-title">Guidelines</h5>
                            {% if status.system_status.guidelines.status == 'available' %}
                                <div class="alert alert-success mb-0">AVAILABLE</div>
                            {% elif status.system_status.guidelines.status == 'error' %}
                                <div class="alert alert-warning mb-0">ERROR</div>
                            {% else %}
                                <div class="alert alert-secondary mb-0">UNKNOWN</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <h3>Environment</h3>
            <div class="card mb-4">
                <div class="card-body">
                    <table class="table table-striped">
                        <tbody>
                            <tr>
                                <th>Environment</th>
                                <td>{{ status.environment }}</td>
                            </tr>
                            <tr>
                                <th>Python Version</th>
                                <td>{{ status.python_version }}</td>
                            </tr>
                            <tr>
                                <th>App Name</th>
                                <td>{{ status.app_name }}</td>
                            </tr>
                            <tr>
                                <th>Debug Mode</th>
                                <td>{{ status.debug_mode }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <h3>MCP Server Status</h3>
            <div class="card mb-4">
                <div class="card-body">
                    {% if status.system_status.mcp_server.status == 'online' %}
                        <div class="alert alert-success">
                            <strong>Connected to MCP Server</strong> - {{ status.system_status.mcp_server.detail.url }}
                        </div>
                        
                        <h5>Available Tools ({{ status.system_status.mcp_server.detail.tool_count }})</h5>
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Tool Name</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for tool in status.system_status.mcp_server.detail.available_tools %}
                                <tr>
                                    <td>{{ tool }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        
                        <h5>Guidelines Tools</h5>
                        {% if status.system_status.mcp_server.detail.guideline_tools_available %}
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Tool Name</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for tool in status.system_status.mcp_server.detail.guideline_tools %}
                                    <tr>
                                        <td>{{ tool }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <div class="alert alert-warning">
                                No guideline tools available
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="alert alert-danger">
                            {{ status.system_status.mcp_server.status }}
                        </div>
                        {% if status.system_status.mcp_server.error %}
                            <div class="alert alert-warning">
                                Error: {{ status.system_status.mcp_server.error }}
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
            
            <h3>Database Status</h3>
            <div class="card mb-4">
                <div class="card-body">
                    {% if status.system_status.database.status == 'connected' %}
                        <div class="alert alert-success">
                            <strong>Connected to Database</strong> - {{ status.system_status.database.detail.db_version }}
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-2">
                                    <div class="card-body">
                                        <h5 class="card-title">World Count</h5>
                                        <p class="card-text display-4 text-center">{{ status.system_status.database.detail.world_count }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-2">
                                    <div class="card-body">
                                        <h5 class="card-title">Guideline Documents</h5>
                                        <p class="card-text display-4 text-center">{{ status.system_status.database.detail.guideline_count }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <h5>Database Tables ({{ status.system_status.database.detail.table_count }})</h5>
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Table Name</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for table in status.system_status.database.detail.tables %}
                                <tr>
                                    <td>{{ table }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <div class="alert alert-danger">
                            {{ status.system_status.database.status }}
                        </div>
                        {% if status.system_status.database.error %}
                            <div class="alert alert-warning">
                                Error: {{ status.system_status.database.error }}
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
            
            <h3>API Testing Tools</h3>
            <div class="card mb-4">
                <div class="card-body">
                    <h5>Test Endpoints</h5>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <a href="{{ url_for('debug.test_triple_preview') }}" target="_blank">Test Triple Preview</a>
                            <span class="text-muted">- Tests RDF triple preview functionality</span>
                        </li>
                        <li class="list-group-item">
                            <a href="{{ url_for('debug.debug_status') }}?format=json" target="_blank">Status JSON</a>
                            <span class="text-muted">- Get system status as JSON</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="mb-5">
                <a href="{{ url_for('index.index') }}" class="btn btn-primary">Back to Home</a>
                <button class="btn btn-outline-primary ml-2" onclick="window.location.reload();">Refresh Status</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
