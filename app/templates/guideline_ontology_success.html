{% extends "base.html" %}

{% block title %}Ontology Updated Successfully - {{ guideline.title }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1>Ontology Updated Successfully</h1>

    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('index.index') }}">Home</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('worlds.view_world', id=world.id) }}">{{ world.name }}</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('worlds.world_guidelines', id=world.id) }}">Guidelines</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('worlds.view_guideline', id=world_id or world.id, document_id=document_id or guideline.id) }}">{{ guideline.title }}</a></li>
            <li class="breadcrumb-item active">Ontology Updated</li>
        </ol>
    </nav>

    <div class="alert alert-success">
        <h4 class="alert-heading"><i class="fas fa-check-circle"></i> Engineering Ethics Ontology Updated!</h4>
        <p>The concepts from this guideline have been successfully integrated into the engineering ethics ontology.</p>
    </div>

    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Integration Summary</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 text-center">
                            <div class="mb-2">
                                <i class="fas fa-plus-circle fa-2x text-success"></i>
                            </div>
                            <h4 class="text-success">{{ result.summary.successful_additions }}</h4>
                            <small class="text-muted">Concepts Added</small>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="mb-2">
                                <i class="fas fa-copy fa-2x text-info"></i>
                            </div>
                            <h4 class="text-info">{{ result.summary.skipped_duplicates }}</h4>
                            <small class="text-muted">Duplicates Skipped</small>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="mb-2">
                                <i class="fas fa-exclamation-triangle fa-2x text-warning"></i>
                            </div>
                            <h4 class="text-warning">{{ result.summary.errors }}</h4>
                            <small class="text-muted">Errors</small>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="mb-2">
                                <i class="fas fa-list fa-2x text-primary"></i>
                            </div>
                            <h4 class="text-primary">{{ result.summary.total_concepts }}</h4>
                            <small class="text-muted">Total Processed</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0"><i class="fas fa-info-circle"></i> Ontology Details</h6>
                </div>
                <div class="card-body">
                    <p><strong>Ontology:</strong> {{ result.ontology_domain }}</p>
                    <p><strong>Version:</strong> New version created</p>
                    <p><strong>Commit Message:</strong></p>
                    <blockquote class="blockquote-footer">
                        {{ result.commit_message }}
                    </blockquote>
                </div>
            </div>
        </div>
    </div>

    {% if result.results %}
    <div class="card mb-4">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-list-alt"></i> Detailed Results</h5>
            <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#detailedResults">
                Show/Hide Details
            </button>
        </div>
        <div class="collapse" id="detailedResults">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Concept</th>
                                <th>Status</th>
                                <th>Type</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in result.results %}
                            <tr>
                                <td><strong>{{ item.concept }}</strong></td>
                                <td>
                                    {% if item.status == 'created' %}
                                        <span class="badge bg-success"><i class="fas fa-plus"></i> Created</span>
                                    {% elif item.status == 'skipped' %}
                                        <span class="badge bg-info"><i class="fas fa-copy"></i> Skipped</span>
                                    {% elif item.status == 'error' %}
                                        <span class="badge bg-danger"><i class="fas fa-exclamation"></i> Error</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if item.entity_type %}
                                        {% set primary_type = item.entity_type.lower() %}
                                        {% set type_colors = {
                                          'role': 'bg-primary',
                                          'principle': 'bg-success', 
                                          'obligation': 'bg-warning',
                                          'state': 'bg-info',
                                          'resource': 'bg-secondary',
                                          'action': 'bg-danger',
                                          'event': 'bg-dark',
                                          'capability': 'bg-light text-dark'
                                        } %}
                                        {% set color_class = type_colors.get(primary_type, 'bg-secondary') %}
                                        <span class="badge {{ color_class }}">{{ item.entity_type.capitalize() }}</span>
                                        {% if item.semantic_category %}
                                            <br><small class="text-muted fst-italic">{{ item.semantic_category }}</small>
                                        {% endif %}
                                    {% endif %}
                                </td>
                                <td>
                                    {% if item.status == 'created' and item.entity_id %}
                                        <small class="text-success">Entity ID: {{ item.entity_id }}</small>
                                    {% elif item.status == 'skipped' and item.reason %}
                                        <small class="text-muted">{{ item.reason }}</small>
                                    {% elif item.status == 'error' and item.error %}
                                        <small class="text-danger">{{ item.error }}</small>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="d-flex justify-content-between">
        <a href="{{ url_for('worlds.world_guidelines', id=world.id) }}" class="btn btn-secondary">
            <i class="fas fa-list"></i> View All Guidelines
        </a>
        
        <div>
            <a href="{{ url_for('worlds.view_guideline', id=world.id, document_id=guideline.id) }}" class="btn btn-outline-primary me-2">
                <i class="fas fa-arrow-left"></i> Back to Guideline
            </a>
            {% if result.summary.successful_additions > 0 or result.ontology_id %}
            <a href="/ontology-editor/?ontology_id={{ result.ontology_id }}&view=full" class="btn btn-success">
                <i class="fas fa-eye"></i> View Updated Ontology
            </a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
{{ super() }}
<style>
    .table td {
        vertical-align: middle;
    }
    
    .alert {
        border-left: 4px solid;
    }
    
    .alert-success {
        border-left-color: #28a745;
    }
</style>
{% endblock %}