{% extends "base.html" %}

{% block title %}Worlds - AI Ethical Decision-Making Simulator{% endblock %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Worlds</h1>
        <div>
            <a href="/worlds/new" class="btn btn-primary">Create New World</a>
        </div>
    </div>

    {% if worlds %}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {% for world in worlds %}
        <div class="col">
            <div class="card h-100">
                <div class="card-body">
                    <div class="mb-2">
                        <h5 class="card-title">{{ world.name }}</h5>
                    </div>
                    <p class="card-text text-truncate" id="description-{{ world.id }}">
                        {{ world.description }}
                    </p>
                    <button class="btn btn-link p-0" onclick="toggleDescription({{ world.id }})"
                        id="toggle-btn-{{ world.id }}">
                        Show More
                    </button>
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">Created: {{ world.created_at.strftime('%Y-%m-%d') }}</small>
                        {% if not is_system_data(world) %}
                        <small class="text-muted">By: {{ get_creator_name(world) }}</small>
                        {% endif %}
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <div class="d-flex justify-content-between">
                        <div>
                            <a href="/worlds/{{ world.id }}" class="btn btn-outline-primary">View Details</a>
                            {% if can_edit_item(world) %}
                            <a href="/worlds/{{ world.id }}/edit" class="btn btn-outline-warning">Edit</a>
                            {% endif %}
                        </div>
                        {% if can_delete_item(world) %}
                        <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal"
                            data-bs-target="#deleteWorldModal{{ world.id }}">
                            Delete
                        </button>
                        {% endif %}
                    </div>
                </div>

                <!-- Delete World Modal - Only show if user can delete -->
                {% if can_delete_item(world) %}
                <div class="modal fade" id="deleteWorldModal{{ world.id }}" tabindex="-1"
                    aria-labelledby="deleteWorldModalLabel{{ world.id }}" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="deleteWorldModalLabel{{ world.id }}">Confirm Deletion</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <p>Are you sure you want to delete the world "{{ world.name }}"?</p>
                                <p class="text-danger">This action cannot be undone. All associated data will be
                                    permanently deleted.</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <form action="{{ url_for('worlds.delete_world_confirm', id=world.id) }}" method="POST">
                                    <button type="submit" class="btn btn-danger">Delete World</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info">
        <p>No worlds have been created yet.</p>
        <a href="/worlds/new" class="btn btn-primary">Create New World</a>
    </div>
    {% endif %}

    <div class="mt-5">
        <h2>What are Worlds?</h2>
        <p>
            Worlds represent the environment and context in which ethical decisions are made.
            They contain characters, resources, conditions, and other entities that form the framework for scenarios.
        </p>
        <p>
            Each world is based on an ontology that defines the types of entities and their relationships.
            Worlds provide the domain-specific elements, rules, and constraints that shape the ethical
            decision-making process in scenarios.
        </p>
        <p>
            When you create a world, you establish the foundation for multiple scenarios that can explore
            different ethical challenges within that domain. The world defines what types of characters,
            resources, and conditions are available, while scenarios represent specific situations within that world.
        </p>
    </div>
</div>
{% endblock %}
