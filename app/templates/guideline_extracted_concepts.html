{% extends "base.html" %}

{% block title %}Extracted Concepts - {{ guideline.title }}{% endblock %}

{% block content %}
<div class="container mt-5">
  <h1>Concepts from {{ guideline.title }}</h1>
  
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{{ url_for('index.index') }}">Home</a></li>
      <li class="breadcrumb-item"><a href="{{ url_for('worlds.view_world', id=world.id) }}">{{ world.name }}</a></li>
      <li class="breadcrumb-item"><a href="{{ url_for('worlds.world_guidelines', id=world.id) }}">Guidelines</a></li>
      <li class="breadcrumb-item"><a href="{{ url_for('worlds.view_guideline', id=world.id, document_id=document_id) }}">{{ guideline.title }}</a></li>
      <li class="breadcrumb-item active">Extracted Concepts</li>
    </ol>
  </nav>
  
  {% if error_message %}
    <div class="alert alert-danger">
      {{ error_message }}
    </div>
  {% endif %}

  {% if success_message %}
    <div class="alert alert-success">
      {{ success_message }}
    </div>
  {% endif %}
  
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <h2 class="card-title h5 mb-0">Guideline Content</h2>
    </div>
    <div class="card-body">
      <div class="mb-4">
        <div style="max-height: 300px; overflow-y: auto; padding: 15px; background-color: #f8f9fa; border-radius: 5px; font-family: monospace;">
          {{ content|safe }}
        </div>
      </div>
    </div>
  </div>
  
  <div class="card">
    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
      <h2 class="card-title h5 mb-0">Extracted Concepts ({{ concepts|length }})</h2>
      <small class="text-white-50">MCP extraction successful</small>
    </div>
    
    <div class="card-body">
      {% if concepts|length > 0 %}
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">Concept</th>
                <th scope="col">Type</th>
                <th scope="col">Description</th>
                <th scope="col">Confidence</th>
              </tr>
            </thead>
            <tbody>
              {% for concept in concepts %}
                <tr>
                  <td width="20%">
                    <strong>{{ concept.name|default(concept.concept_name, true)|default(concept.label, true) }}</strong>
                  </td>
                  <td width="15%">
                    <span class="badge bg-info">{{ concept.type|default(concept.concept_type, true) }}</span>
                  </td>
                  <td width="50%">
                    {{ concept.description|default(concept.concept_description, true)|default('No description available', true) }}
                  </td>
                  <td width="15%">
                    {% if concept.confidence is defined %}
                      <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-success" role="progressbar" 
                             style="width: {{ (concept.confidence * 100)|int }}%;" 
                             aria-valuenow="{{ (concept.confidence * 100)|int }}" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                          {{ (concept.confidence * 100)|int }}%
                        </div>
                      </div>
                    {% else %}
                      <span class="badge bg-secondary">N/A</span>
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="alert alert-info mt-3">
          <h5 class="alert-heading"><i class="fas fa-info-circle"></i> Concept Extraction Only</h5>
          <p>
            These concepts were extracted using the MCP ontology service. 
            For more advanced features like generating triples for the knowledge graph, the LLM service needs to be available.
          </p>
        </div>
      {% else %}
        <div class="alert alert-warning">
          <p class="mb-0">No concepts were extracted from this guideline.</p>
        </div>
      {% endif %}
      
      <div class="d-flex justify-content-between mt-3">
        <a href="{{ url_for('worlds.world_guidelines', id=world.id) }}" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Back to Guidelines
        </a>
        <a href="{{ url_for('worlds.view_guideline', id=world.id, document_id=document_id) }}" class="btn btn-primary">
          <i class="fas fa-book"></i> View Complete Guideline
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
