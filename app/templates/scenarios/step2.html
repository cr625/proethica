{% extends "scenarios/base_step.html" %}

{% block step_title %}Normative Pass - Discussion/Analysis Section{% endblock %}
{% block step_header %}Normative Pass{% endblock %}
{% block step_subtitle %}Extract principles, obligations, and constraints from the discussion/analysis section{% endblock %}

{% block step_navigation %}
<div class="d-flex justify-content-between mb-3">
    <a href="{{ url_for('scenario_pipeline.step1a', case_id=case.id) }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Back to Step 1a
    </a>
    <span class="text-muted">Step 3: Coming Soon</span>
</div>
{% endblock %}

{% block step_content %}
<div class="step-card">
    <div class="step-header">
        <h4 class="mb-0">
            <i class="bi bi-chat-text"></i> Discussion/Analysis Section
        </h4>
    </div>
    <div class="step-content">
        {% if discussion_section %}
        <div class="alert alert-info mb-3">
            <h6 class="mb-2"><i class="bi bi-info-circle"></i> Section Content:</h6>
            <pre class="discussion-text">{{ discussion_section.llm_text }}</pre>
        </div>
        
        <!-- Normative Pass Button (Currently Disabled - Coming Soon) -->
        <div class="d-grid gap-2 d-md-flex justify-content-md-center mb-3">
            <button id="normativePassBtn" class="btn btn-secondary btn-lg" disabled>
                <i class="bi bi-arrow-right-circle"></i> Normative Pass
                <small class="d-block">Coming Soon - Extract Principles + Obligations + Constraints</small>
            </button>
        </div>
        
        <div class="alert alert-warning">
            <i class="bi bi-info-circle"></i>
            <strong>Note:</strong> The Normative Pass extraction will be enabled once the enhanced prompts for Principles, Obligations, and Constraints are implemented.
        </div>
        
        {% else %}
        <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle"></i>
            No discussion/analysis section found in this case. Using available section.
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}

{% block step_styles %}
<style>
    .discussion-text {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 0.9rem;
        background-color: #f8f9fa;
        padding: 0.75rem;
        border-radius: 0.25rem;
        border: none;
        margin: 0;
        white-space: pre-wrap;
        max-height: 400px;
        overflow-y: auto;
    }

    .alert-info {
        background-color: #d1ecf1;
        border-color: #bee5eb;
        color: #0c5460;
    }

    /* Normative Pass Button Styling (disabled state) */
    #normativePassBtn {
        padding: 1rem 2rem;
        font-size: 1.1rem;
        border-radius: 50px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }

    #normativePassBtn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
</style>
{% endblock %}

{% block step_scripts %}
<script>
// Placeholder for future normative pass functionality
console.log('Step 2: Normative Pass - Discussion/Analysis Section loaded');
</script>
{% endblock %}