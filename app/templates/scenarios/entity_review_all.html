{% extends "scenarios/base_step.html" %}

{% block step_title %}All Extracted Entities - {{ case.title }}{% endblock %}
{% block step_header %}All Extracted Entities{% endblock %}
{% block step_subtitle %}Review entities from all three extraction passes{% endblock %}

{% block step_content %}

<div class="card mb-4">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">
            <i class="bi bi-diagram-3"></i> Entity Summary (All Passes)
        </h5>
    </div>
    <div class="card-body">
        <div class="row">
            <!-- Pass 1 -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-info bg-opacity-10">
                        <h6 class="mb-0">Pass 1: Contextual Framework</h6>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled mb-3">
                            <li><strong>Roles:</strong> {{ entities_summary.roles }}</li>
                            <li><strong>States:</strong> {{ entities_summary.states }}</li>
                            <li><strong>Resources:</strong> {{ entities_summary.resources }}</li>
                        </ul>
                        <hr>
                        <p class="mb-2"><strong>Total:</strong> {{ entities_summary.pass1_total }}</p>
                        <a href="{{ url_for('entity_review.review_case_entities', case_id=case.id, section_type='facts') }}"
                           class="btn btn-sm btn-outline-info w-100">
                            <i class="bi bi-eye"></i> View Pass 1 Entities
                        </a>
                    </div>
                </div>
            </div>

            <!-- Pass 2 -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-warning bg-opacity-10">
                        <h6 class="mb-0">Pass 2: Normative Requirements</h6>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled mb-3">
                            <li><strong>Principles:</strong> {{ entities_summary.principles }}</li>
                            <li><strong>Obligations:</strong> {{ entities_summary.obligations }}</li>
                            <li><strong>Constraints:</strong> {{ entities_summary.constraints }}</li>
                            <li><strong>Capabilities:</strong> {{ entities_summary.capabilities }}</li>
                        </ul>
                        <hr>
                        <p class="mb-2"><strong>Total:</strong> {{ entities_summary.pass2_total }}</p>
                        <a href="{{ url_for('entity_review.review_case_entities_pass2', case_id=case.id) }}"
                           class="btn btn-sm btn-outline-warning w-100">
                            <i class="bi bi-eye"></i> View Pass 2 Entities
                        </a>
                    </div>
                </div>
            </div>

            <!-- Pass 3 -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-success bg-opacity-10">
                        <h6 class="mb-0">Pass 3: Temporal Dynamics</h6>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled mb-3">
                            <li><strong>Actions:</strong> {{ entities_summary.actions }}</li>
                            <li><strong>Events:</strong> {{ entities_summary.events }}</li>
                        </ul>
                        <hr>
                        <p class="mb-2"><strong>Total:</strong> {{ entities_summary.pass3_total }}</p>
                        <a href="{{ url_for('entity_review.review_case_entities_pass3', case_id=case.id) }}"
                           class="btn btn-sm btn-outline-success w-100">
                            <i class="bi bi-eye"></i> View Pass 3 Entities
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <hr class="my-4">

        <div class="row">
            <div class="col-md-12 text-center">
                <h3><strong>Total Entities:</strong> {{ entities_summary.total }}</h3>
                <p class="text-muted">From all three extraction passes</p>
            </div>
        </div>
    </div>
</div>

<!-- Navigation -->
<div class="card">
    <div class="card-header">
        <h6 class="mb-0">
            <i class="bi bi-info-circle"></i> About the Extraction Passes
        </h6>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-4">
                <h6><i class="bi bi-1-circle text-info"></i> Pass 1: Contextual Framework</h6>
                <p class="small">Extracts WHO acts (Roles), WHERE (States), and with WHAT knowledge (Resources)</p>
            </div>
            <div class="col-md-4">
                <h6><i class="bi bi-2-circle text-warning"></i> Pass 2: Normative Requirements</h6>
                <p class="small">Extracts WHAT agents SHOULD/MUST do: Principles, Obligations, Constraints, and Capabilities</p>
            </div>
            <div class="col-md-4">
                <h6><i class="bi bi-3-circle text-success"></i> Pass 3: Temporal Dynamics</h6>
                <p class="small">Extracts WHAT happens over time: Actions (volitional decisions) and Events (occurrences)</p>
            </div>
        </div>
    </div>
</div>

<div class="text-center mt-4">
    <a href="{{ url_for('scenario_pipeline.step4_synthesis', case_id=case.id) }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Back to Step 4
    </a>
</div>

{% endblock %}
